:root {
  --hue: 60;
  --bg-base: hsl(var(--hue) 10% 8%);
  --bg-surface: hsl(var(--hue) 8% 12%);
  --bg-elevated: hsl(var(--hue) 8% 16%);
  --bg-hover: hsl(var(--hue) 10% 20%);
  --border: hsl(var(--hue) 8% 22%);
  --border-light: hsl(var(--hue) 6% 28%);
  --text-primary: hsl(var(--hue) 10% 90%);
  --text-secondary: hsl(var(--hue) 6% 65%);
  --text-muted: hsl(var(--hue) 4% 45%);
  --accent: hsl(var(--hue) 70% 55%);
  --accent-dim: hsl(var(--hue) 50% 25%);
  --accent-glow: hsl(var(--hue) 70% 55% / .15);
  --glass: hsl(var(--hue) 8% 14% / .85);
  --shadow: 0 4px 24px hsl(0 0% 0% / .4);
  --radius: 10px;
  --radius-sm: 6px;
  --transition: .2s cubic-bezier(.4,0,.2,1);
  --font: "Inter", system-ui, sans-serif;
  --font-mono: "JetBrains Mono", monospace;
  --toolbar-h: 52px;
}

body.theme-light {
  --bg-base: hsl(var(--hue) 15% 97%);
  --bg-surface: hsl(var(--hue) 12% 93%);
  --bg-elevated: hsl(var(--hue) 10% 100%);
  --bg-hover: hsl(var(--hue) 12% 88%);
  --border: hsl(var(--hue) 10% 82%);
  --border-light: hsl(var(--hue) 8% 75%);
  --text-primary: hsl(var(--hue) 15% 15%);
  --text-secondary: hsl(var(--hue) 8% 40%);
  --text-muted: hsl(var(--hue) 5% 58%);
  --accent: hsl(var(--hue) 65% 42%);
  --accent-dim: hsl(var(--hue) 40% 85%);
  --accent-glow: hsl(var(--hue) 65% 42% / .1);
  --glass: hsl(var(--hue) 12% 96% / .92);
  --shadow: 0 4px 20px hsl(var(--hue) 10% 50% / .12);
}

body.theme-deep-blue {
  --hue: 220;
  --bg-base: hsl(220 35% 10%);
  --bg-surface: hsl(220 30% 14%);
  --bg-elevated: hsl(220 28% 19%);
  --bg-hover: hsl(220 25% 24%);
  --border: hsl(220 22% 26%);
  --border-light: hsl(220 18% 32%);
  --text-primary: hsl(215 25% 90%);
  --text-secondary: hsl(215 15% 65%);
  --text-muted: hsl(215 10% 48%);
  --accent: hsl(205 80% 60%);
  --accent-dim: hsl(205 50% 22%);
  --accent-glow: hsl(205 80% 60% / .12);
  --glass: hsl(220 30% 13% / .88);
  --shadow: 0 4px 24px hsl(220 40% 4% / .5);
}

body.theme-high-contrast {
  --bg-base: #000000;
  --bg-surface: #0a0a0a;
  --bg-elevated: #1a1a1a;
  --bg-hover: #2a2a2a;
  --border: #555555;
  --border-light: #777777;
  --text-primary: #ffffff;
  --text-secondary: #e0e0e0;
  --text-muted: #b0b0b0;
  --accent: #ffdd00;
  --accent-dim: #3d3500;
  --accent-glow: rgba(255, 221, 0, .15);
  --glass: rgba(10, 10, 10, .95);
  --shadow: 0 4px 24px rgba(0, 0, 0, .8);
}

* { margin:0; padding:0; box-sizing:border-box; }
html,body { height:100%; overflow:hidden; }
body { font-family:var(--font); background:var(--bg-base); color:var(--text-primary); }
::selection { background:var(--accent-dim); color:var(--text-primary); }
::-webkit-scrollbar { width:6px; height:6px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }
::-webkit-scrollbar-thumb:hover { background:var(--border-light); }

.theme-picker-btn {
  position:fixed; bottom:24px; right:24px; z-index:999;
  width:48px; height:48px; border-radius:50%;
  background:var(--glass); backdrop-filter:blur(12px);
  border:1px solid var(--border); cursor:pointer;
  display:flex; align-items:center; justify-content:center;
  font-size:22px; box-shadow:var(--shadow);
  transition:transform var(--transition), box-shadow var(--transition);
}
.theme-picker-btn:hover { transform:scale(1.1); box-shadow:0 6px 32px hsl(0 0% 0%/.5); }
.theme-picker-panel {
  position:fixed; bottom:82px; right:24px; z-index:998;
  width:220px; padding:16px; border-radius:var(--radius);
  background:var(--glass); backdrop-filter:blur(16px);
  border:1px solid var(--border); box-shadow:var(--shadow);
}
.theme-picker-panel.hidden { display:none; }
.theme-picker-panel h4 { font-size:13px; color:var(--text-secondary); margin-bottom:10px; font-weight:500; }
.theme-picker-panel input[type=range] {
  width:100%; height:8px; -webkit-appearance:none; appearance:none;
  border-radius:4px; outline:none; cursor:pointer;
  background:linear-gradient(to right,
    hsl(0 70% 55%),hsl(30 70% 55%),hsl(60 70% 55%),hsl(90 70% 55%),
    hsl(120 70% 55%),hsl(150 70% 55%),hsl(180 70% 55%),hsl(210 70% 55%),
    hsl(240 70% 55%),hsl(270 70% 55%),hsl(300 70% 55%),hsl(330 70% 55%),hsl(360 70% 55%));
}
.theme-picker-panel input[type=range]::-webkit-slider-thumb {
  -webkit-appearance:none; width:18px; height:18px; border-radius:50%;
  background:white; border:2px solid var(--accent); box-shadow:0 2px 6px rgba(0,0,0,.3);
}
.hue-preview { height:6px; border-radius:3px; margin:8px 0 12px; background:var(--accent); transition:background .15s; }
.preset-colors { display:flex; gap:8px; flex-wrap:wrap; justify-content:center; }
.preset {
  width:24px; height:24px; border-radius:50%; cursor:pointer;
  background:hsl(var(--ph) 70% 55%); border:2px solid transparent;
  transition:transform var(--transition), border-color var(--transition);
}
.preset:hover { transform:scale(1.2); border-color:white; }

.toolbar {
  height:var(--toolbar-h); display:flex; align-items:center;
  padding:0 12px; gap:8px;
  background:var(--glass); backdrop-filter:blur(12px);
  border-bottom:1px solid var(--border); z-index:100;
}
.toolbar-left,.toolbar-right { display:flex; align-items:center; gap:6px; }
.toolbar-left { min-width:180px; }
.toolbar-center { flex:1; display:flex; align-items:center; justify-content:center; gap:4px; flex-wrap:wrap; }
.toolbar-right { min-width:180px; justify-content:flex-end; }
.brand { font-size:15px; font-weight:600; color:var(--accent); letter-spacing:.5px; }
.tool-btn {
  height:34px; min-width:34px; padding:0 8px; border:none; border-radius:var(--radius-sm);
  background:transparent; color:var(--text-secondary); cursor:pointer;
  font-family:var(--font); font-size:14px; display:flex; align-items:center; justify-content:center;
  transition:all var(--transition);
}
.tool-btn:hover { background:var(--bg-hover); color:var(--text-primary); }
.tool-btn.accent { color:var(--accent); font-weight:600; }
.tool-btn.accent:hover { background:var(--accent-glow); }
.tool-sep { width:1px; height:20px; background:var(--border); margin:0 2px; }
.tool-group { display:flex; gap:2px; }
.view-switch { display:flex; background:var(--bg-surface); border-radius:var(--radius-sm); overflow:hidden; margin-right:8px; }
.view-btn {
  padding:6px 12px; border:none; background:transparent; color:var(--text-muted);
  font-size:12px; font-family:var(--font); cursor:pointer; transition:all var(--transition);
}
.view-btn.active { background:var(--accent-dim); color:var(--accent); }
.view-btn:hover:not(.active) { color:var(--text-secondary); }

.lang-btn { font-size:16px !important; }
.lang-dropdown {
  position:fixed; top:var(--toolbar-h); right:12px; z-index:300;
  min-width:160px; padding:6px; border-radius:var(--radius);
  background:var(--glass); backdrop-filter:blur(16px);
  border:1px solid var(--border); box-shadow:var(--shadow);
}
.lang-dropdown.hidden { display:none; }
.lang-opt {
  display:flex; align-items:center; gap:10px;
  padding:9px 14px; border-radius:var(--radius-sm); cursor:pointer;
  font-size:13px; color:var(--text-secondary);
  transition:all var(--transition); border:1px solid transparent;
}
.lang-opt:hover { background:var(--bg-hover); color:var(--text-primary); }
.lang-opt.active { color:var(--accent); border-color:var(--accent); background:var(--accent-glow); }
.lang-flag { font-size:16px; line-height:1; }

.main-layout { display:flex; height:calc(100% - var(--toolbar-h)); }
.module-panel {
  width:260px; background:var(--bg-surface); border-right:1px solid var(--border);
  display:flex; flex-direction:column;
}
.panel-header { padding:14px; border-bottom:1px solid var(--border); }
.module-search {
  width:100%; margin-top:8px; padding:8px 10px; border-radius:var(--radius-sm);
  border:1px solid var(--border); background:var(--bg-elevated); color:var(--text-primary);
}
.module-list { flex:1; overflow:auto; padding:12px; display:flex; flex-direction:column; gap:8px; }
.module-item { padding:10px; border-radius:var(--radius-sm); background:var(--bg-elevated); cursor:pointer; transition:var(--transition); }
.module-item:hover { background:var(--bg-hover); color:var(--text-primary); }

.editor-section, .preview-section { flex:1; height:100%; }
.editor-textarea {
  width:100%; height:100%; border:none; outline:none; resize:none;
  padding:18px; background:var(--bg-base); color:var(--text-primary);
  font-family:var(--font-mono); font-size:14px; line-height:1.6;
}
.preview-section { background:var(--bg-base); overflow:auto; }
.preview-content { padding:18px; color:var(--text-primary); }

.preview-section.hidden, .module-panel.hidden { display:none; }

.modal { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:600; }
.modal.hidden { display:none; }
.modal-overlay { position:absolute; inset:0; background:rgba(0,0,0,.6); }
.modal-content {
  position:relative; z-index:1; width:720px; max-width:90%;
  background:var(--bg-surface); border:1px solid var(--border); border-radius:var(--radius);
  box-shadow:var(--shadow); overflow:hidden;
}
.modal-content.modal-sm { width:360px; }
.modal-header { display:flex; justify-content:space-between; align-items:center; padding:14px 16px; border-bottom:1px solid var(--border); }
.modal-body { padding:16px; max-height:70vh; overflow:auto; }
.modal-footer { display:flex; justify-content:flex-end; gap:10px; padding:14px 16px; border-top:1px solid var(--border); }
.modal-close { background:transparent; border:none; color:var(--text-secondary); cursor:pointer; font-size:16px; }
.btn-primary {
  background:var(--accent); color:white; border:none; padding:8px 16px; border-radius:var(--radius-sm); cursor:pointer;
}
.btn-secondary {
  background:var(--bg-elevated); color:var(--text-primary); border:1px solid var(--border); padding:8px 16px; border-radius:var(--radius-sm); cursor:pointer;
}

.fm-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:12px; }
.fm-grid label { display:flex; flex-direction:column; gap:6px; font-size:13px; color:var(--text-secondary); }
.fm-grid input, .fm-grid textarea, .fm-grid select {
  background:var(--bg-elevated); border:1px solid var(--border); color:var(--text-primary);
  border-radius:var(--radius-sm); padding:8px 10px; font-size:13px;
}
.fm-row { grid-column:1/-1; display:flex; gap:14px; align-items:center; flex-wrap:wrap; }
.fm-check { display:flex; gap:6px; align-items:center; }

.export-options { display:flex; flex-direction:column; gap:8px; }
.export-btn {
  padding:10px 12px; border-radius:var(--radius-sm); border:1px solid var(--border);
  background:var(--bg-elevated); color:var(--text-primary); cursor:pointer; text-align:left;
}

.drop-overlay { position:fixed; inset:0; background:rgba(0,0,0,.6); display:flex; align-items:center; justify-content:center; z-index:700; }
.drop-overlay.hidden { display:none; }
.drop-message { background:var(--bg-surface); padding:22px 28px; border-radius:var(--radius); border:1px solid var(--border); color:var(--text-primary); text-align:center; }

@media (max-width: 1024px) {
  .module-panel { width:210px; }
  .toolbar-center { display:none; }
}
@media (max-width: 720px) {
  .module-panel { display:none; }
  .main-layout { flex-direction:column; }
  .editor-section, .preview-section { height:50%; }
  .fm-grid { grid-template-columns:1fr; }
}
